<Window x:Class="BoltDownloader.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:BoltDownloader.Converters"
        Title="{DynamicResource App_Title}" 
        Height="600" Width="900"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource SurfaceColor}">
    
    <Window.Resources>
        <!-- Estilo para botones de la barra de herramientas -->
        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Background" Value="{DynamicResource SurfaceAltColor}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource HoverColor}"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Conversor: color de fila por estado -->
        <conv:StatusToBrushConverter x:Key="StatusToBrush" />
    </Window.Resources>
    
    <DockPanel>
        <!-- MenÃº Principal -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="{DynamicResource MainMenu_File}">
                <MenuItem Header="{DynamicResource MainMenu_File_NewDownload}" Click="NewDownload_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_File_AddBatch}" Click="BatchDownload_Click"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MainMenu_File_Import}" Click="ImportDownloads_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_File_Export}" Click="ExportDownloads_Click"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MainMenu_File_Exit}" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="{DynamicResource MainMenu_Downloads}">
                <MenuItem Header="{DynamicResource MainMenu_Downloads_Start}" Click="StartDownload_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_Downloads_Pause}" Click="PauseDownload_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_Downloads_Resume}" Click="ResumeDownload_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_Downloads_Cancel}" Click="CancelDownload_Click"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MainMenu_Downloads_PauseAll}" Click="PauseAll_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_Downloads_ResumeAll}" Click="ResumeAll_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_Downloads_CancelAll}" Click="CancelAll_Click"/>
                <Separator/>
                <MenuItem Header="{DynamicResource MainMenu_Downloads_DeleteFromList}" Click="DeleteDownload_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_Downloads_DeleteCompleted}" Click="DeleteCompleted_Click"/>
            </MenuItem>
            <MenuItem Header="{DynamicResource MainMenu_Scheduler}">
                <MenuItem Header="{DynamicResource MainMenu_Scheduler_Add}" Click="AddScheduledTask_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_Scheduler_View}" Click="ViewSchedules_Click"/>
            </MenuItem>
            <MenuItem Header="{DynamicResource MainMenu_Options}">
                <MenuItem Header="{DynamicResource MainMenu_Options_Settings}" Click="Settings_Click"/>
                <MenuItem Header="{DynamicResource MainMenu_Options_SpeedLimit}" Click="SpeedLimit_Click"/>
            </MenuItem>
            <MenuItem Header="{DynamicResource MainMenu_Help}">
                <MenuItem Header="{DynamicResource MainMenu_Help_About}" Click="About_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- Barra de Herramientas -->
        <ToolBarTray DockPanel.Dock="Top" Background="{DynamicResource SurfaceColor}">
            <ToolBar Background="Transparent" BorderThickness="0,0,0,1" BorderBrush="{DynamicResource BorderColor}">
                <Button x:Name="btnAdd" Style="{StaticResource ToolbarButtonStyle}" 
                        Click="NewDownload_Click" ToolTip="{DynamicResource Toolbar_Add_Tooltip}"
                        Background="{DynamicResource PrimaryColor}" Foreground="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âž•" FontSize="14" Margin="0,0,5,0"/>
                        <TextBlock Text="{DynamicResource Toolbar_Add_Text}"/>
                    </StackPanel>
                </Button>
                
                <Button x:Name="btnPause" Style="{StaticResource ToolbarButtonStyle}" 
                        Click="PauseDownload_Click" ToolTip="{DynamicResource Toolbar_Pause_Tooltip}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â¸" FontSize="14" Margin="0,0,5,0"/>
                        <TextBlock Text="{DynamicResource Toolbar_Pause_Text}"/>
                    </StackPanel>
                </Button>
                
                <Button x:Name="btnResume" Style="{StaticResource ToolbarButtonStyle}" 
                        Click="ResumeDownload_Click" ToolTip="{DynamicResource Toolbar_Resume_Tooltip}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â–¶" FontSize="14" Margin="0,0,5,0"/>
                        <TextBlock Text="{DynamicResource Toolbar_Resume_Text}"/>
                    </StackPanel>
                </Button>
                
                <Separator/>
                
                <Button x:Name="btnDelete" Style="{StaticResource ToolbarButtonStyle}" 
                        Click="DeleteDownload_Click" ToolTip="{DynamicResource Toolbar_Delete_Tooltip}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ—‘" FontSize="14" Margin="0,0,5,0"/>
                        <TextBlock Text="{DynamicResource Toolbar_Delete_Text}"/>
                    </StackPanel>
                </Button>
                
                <Separator/>
                
                <Button x:Name="btnSettings" Style="{StaticResource ToolbarButtonStyle}" 
                        Click="Settings_Click" ToolTip="{DynamicResource Toolbar_Settings_Tooltip}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âš™" FontSize="14" Margin="0,0,5,0"/>
                        <TextBlock Text="{DynamicResource Toolbar_Settings_Text}"/>
                    </StackPanel>
                </Button>
            </ToolBar>
        </ToolBarTray>
        
        <!-- Barra de Estado -->
        <StatusBar DockPanel.Dock="Bottom" Background="{DynamicResource SurfaceColor}" Height="25">
            <StatusBarItem>
                <TextBlock x:Name="txtStatusBar" Text="{DynamicResource Status_Ready}" FontSize="11"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtActiveDownloads" Text="0 descargas activas" FontSize="11"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtTotalSpeed" Text="0 KB/s" FontSize="11"/>
            </StatusBarItem>
        </StatusBar>
        
        <!-- Tabla de Descargas + Panel de CategorÃ­as -->
        <Grid DockPanel.Dock="Top" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Panel lateral de categorÃ­as -->
            <Border Grid.Column="0" Background="{DynamicResource SurfaceAltColor}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="4" Padding="6" Margin="0,0,6,0">
                <DockPanel>
                    <ListBox x:Name="lstCategories"
                             BorderThickness="0"
                             Background="Transparent"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             SelectionChanged="lstCategories_SelectionChanged">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Foreground="{DynamicResource TextPrimaryBrush}" TextAlignment="Left" Text="{Binding .}"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <DataGrid x:Name="dgDownloads" Grid.Column="1"
                      AutoGenerateColumns="False"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      GridLinesVisibility="Vertical"
                      VerticalGridLinesBrush="{DynamicResource BorderColor}"
                      HeadersVisibility="Column"
                      Background="{DynamicResource SurfaceColor}"
                      Foreground="{DynamicResource TextPrimaryBrush}"
                      RowHeight="35"
                      SelectionChanged="dgDownloads_SelectionChanged">
                <DataGrid.ContextMenu>
                    <ContextMenu Opened="dgContextMenu_Opened">
                        <MenuItem x:Name="ctxOpenFile" Header="{DynamicResource Context_OpenFile}" Click="OpenFileFromList_Click"/>
                        <MenuItem x:Name="ctxOpenFolder" Header="{DynamicResource Context_OpenFolder}" Click="OpenFolderFromList_Click"/>
                        <Separator/>
                        <MenuItem x:Name="ctxStart" Header="{DynamicResource Context_Start}" Click="StartDownload_Click"/>
                        <MenuItem x:Name="ctxPause" Header="{DynamicResource Context_Pause}" Click="PauseDownload_Click"/>
                        <MenuItem x:Name="ctxResume" Header="{DynamicResource Context_Resume}" Click="ResumeDownload_Click"/>
                        <MenuItem x:Name="ctxCancel" Header="{DynamicResource Context_Cancel}" Click="CancelDownload_Click"/>
                        <MenuItem x:Name="ctxDelete" Header="{DynamicResource Context_Delete}" Click="DeleteDownload_Click"/>
                        <Separator/>
                        <MenuItem x:Name="ctxCopyUrl" Header="{DynamicResource Context_CopyUrl}" Click="CopyUrl_Click"/>
                        <MenuItem x:Name="ctxCopyFileName" Header="{DynamicResource Context_CopyFileName}" Click="CopyFileName_Click"/>
                        <MenuItem x:Name="ctxCopyFullPath" Header="{DynamicResource Context_CopyFullPath}" Click="CopyFullPath_Click"/>
                        <MenuItem x:Name="ctxOpenReferrer" Header="{DynamicResource Context_OpenReferrer}" Click="OpenReferrer_Click"/>
                        <Separator/>
                        <MenuItem x:Name="miMoveToCategory" Header="{DynamicResource Context_MoveToCategory}" SubmenuOpened="miMoveToCategory_SubmenuOpened"/>
                        <Separator/>
                        <MenuItem x:Name="ctxProperties" Header="{DynamicResource Context_Properties}" Click="ShowProperties_Click"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Background" Value="{Binding Status, Converter={StaticResource StatusToBrush}}"/>
                        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{DynamicResource SelectedBackgroundBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource SelectedForegroundBrush}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <!-- Let the row background show through -->
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <!-- Keep cell bg transparent so the row selection color is visible -->
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Foreground" Value="{DynamicResource SelectedForegroundBrush}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.CellStyle>
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="{DynamicResource SurfaceAltColor}"/>
                        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}"/>
                        <Setter Property="BorderThickness" Value="0,0,0,1"/>
                        <Setter Property="Padding" Value="6,4"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="{DynamicResource Column_Name}" Binding="{Binding FileName}" Width="2*" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                        <DataGridTextColumn.EditingElementStyle>
                            <Style TargetType="TextBox">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                <Setter Property="Background" Value="{DynamicResource SurfaceAltColor}"/>
                                <Setter Property="CaretBrush" Value="{DynamicResource TextPrimaryBrush}"/>
                            </Style>
                        </DataGridTextColumn.EditingElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="{DynamicResource Column_Size}" Binding="{Binding FileSizeFormatted}" Width="100" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="{DynamicResource Column_Status}" Binding="{Binding Status}" Width="120" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="{DynamicResource Column_Speed}" Binding="{Binding SpeedFormatted}" Width="100" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn Header="{DynamicResource Column_Progress}" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <ProgressBar Value="{Binding Progress}" Maximum="100" Height="20"/>
                                    <TextBlock Text="{Binding ProgressText}" 
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"
                                             FontSize="10"
                                             FontWeight="Bold"
                                             Foreground="{DynamicResource TextPrimaryBrush}"/>
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="{DynamicResource Column_TimeRemaining}" Binding="{Binding TimeRemainingFormatted}" Width="120" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </DockPanel>
</Window>
